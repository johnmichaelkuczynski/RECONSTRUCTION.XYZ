FIX THE FOLLOWING BUGS IN THE IPO PRICING FUNCTION:

BUG 1: DOWN-ROUND RISK NOT FLAGGED OR DISCOUNTED
Current behavior: Function recommends $53 with no mention that this is a DOWN ROUND.
Correct behavior: When risk_factors.down_round_optics == true, the function MUST:

Flag prominently in output
Calculate down-round percentage
Apply historical down-round discount

The input provides:

capital_structure.last_private_round.price_per_share = 59.86
historical_benchmarks.down_round_ipo_penalty.avg_additional_discount_vs_last_round = 0.22

At $53:

Down-round % = ($53 − $59.86) / $59.86 = −11.5%
This IS a down round and headlines WILL say so

Add to output:
DOWN-ROUND ALERT:
  Series E price: $59.86
  Offer price: $53.00
  Down-round: -11.5%
  Narrative risk: HIGH — "Synapse AI IPO values company below last private round"
Add down-round discount to Day-1 pop calculation:
if (risk_factors.down_round_optics == true) {
  down_round_pct = (offer_price - last_private_round.price_per_share) / last_private_round.price_per_share
  
  if (down_round_pct < 0) {
    down_round_discount = Math.abs(down_round_pct) * 0.5  // 50% pass-through of down-round to pop penalty
    adjusted_pop = adjusted_pop - down_round_discount
  }
}
At $53 with −11.5% down-round: penalty = 11.5% × 0.5 = −5.75%

BUG 2: DUAL-CLASS GOVERNANCE DISCOUNT NOT APPLIED
Current behavior: No adjustment for dual-class structure.
Correct behavior: When capital_structure.dual_class == true, apply governance discount.
The input provides:

historical_benchmarks.dual_class_discount.avg_governance_discount = 0.06
special_considerations.dual_class_structure.typical_discount = 0.05

Add to pop calculation:
if (capital_structure.dual_class == true) {
  governance_discount = historical_benchmarks.dual_class_discount.avg_governance_discount || 0.05
  adjusted_pop = adjusted_pop - governance_discount
}
Missing penalty: −5% to −6%

BUG 3: OVERSUBSCRIPTION AT PRICES ABOVE BOOK TIERS NOT EXTRAPOLATED
Current behavior: Shows 6.2× at $51, $52, $53 — same as $48.
Correct behavior: The order book only goes up to $48. For prices above the highest tier, coverage DECLINES. The function must extrapolate.
Order book:

$48+: 6.2×
$45+: 11.4×
$42+: 18.7×
$38+: 28.3×

Pattern: Each $3 increment roughly halves coverage. Extrapolate:
function extrapolate_oversubscription(price, order_book) {
  highest_tier = order_book.indications[0]  // $48, 6.2×
  
  if (price > highest_tier.price_floor) {
    price_gap = price - highest_tier.price_floor
    decay_rate = 0.15  // ~15% coverage loss per $1 above top tier
    extrapolated = highest_tier.oversubscription_multiple * Math.pow((1 - decay_rate), price_gap)
    return extrapolated
  }
  // else return from tiers...
}
At $53 (which is $5 above $48 tier):

Extrapolated coverage = 6.2× × (0.85)^5 = 2.75×

This is a WEAK book at $53, not 6.2×.

BUG 4: PRICE-SENSITIVE INVESTOR DROP-OFF NOT MODELED
Current behavior: Function ignores max price constraints from generalist investors.
Correct behavior: Parse order_book.notable_orders[].max_price and subtract from coverage when offer price exceeds.
The input shows:

Fidelity: $75M, max $42
T. Rowe Price: $60M, max $40
Capital Group: $55M, max $44
Coatue: $95M, max $46

At $53, ALL FOUR DROP OUT. That's $285M of demand gone.
function calculate_effective_coverage(price, order_book) {
  base_demand = get_total_demand_at_price(price)
  
  for (investor in order_book.notable_orders) {
    if (investor.max_price && price > investor.max_price) {
      base_demand -= investor.indicated_size
    }
  }
  
  effective_coverage = base_demand / offering_size
  return effective_coverage
}
Add to output:
Price-Sensitive Investor Analysis:
  Investors dropping at $53: Fidelity, T. Rowe, Capital Group, Coatue
  Demand lost: $285M
  Remaining anchors: Tiger Global, Sequoia (both underwater, defending)
  Book quality: DEGRADED

BUG 5: GROWTH DECELERATION NOT FACTORED INTO MULTIPLE
Current behavior: Uses peer median 11.8× without adjusting for growth trajectory.
Correct behavior: Synapse growth is DECELERATING (63% → 43% → 35%). Comps with decelerating growth trade at discounts.
The input provides growth rates. Apply growth-adjusted multiple:
if (financials.growth_rates.fy2025_to_fy2026_growth < financials.growth_rates.fy2024_to_fy2025_growth) {
  decel_rate = 1 - (fy2025_to_fy2026_growth / fy2024_to_fy2025_growth)
  decel_penalty = decel_rate * 0.15  // 15% multiple compression per 10% decel
  adjusted_peer_multiple = peer_median * (1 - decel_penalty)
}
Synapse decel: (63% − 43%) / 63% = 32% deceleration
Penalty: 32% × 0.15 = 4.8% multiple compression
Adjusted peer median: 11.8× × 0.952 = 11.2×
At $53, Synapse trades at 10.5× — now only 6% discount vs. growth-adjusted peers, not 11%.

BUG 6: CUSTOMER CONCENTRATION DISCOUNT MISSING
Current behavior: No adjustment for customer concentration risk.
Correct behavior: When top 5 customers > 40% of revenue, apply concentration discount.
The input provides:

financials.customer_concentration.top_5_customers_pct = 0.47

if (customer_concentration.top_5_customers_pct > 0.40) {
  concentration_risk = (top_5_customers_pct - 0.40) * 0.5
  adjusted_pop = adjusted_pop - concentration_risk
}
Synapse: (47% − 40%) × 0.5 = −3.5% pop penalty

BUG 7: PRIMARY VS. SECONDARY PROCEEDS NOT DISTINGUISHED
Current behavior: Shows "Gross proceeds: $1524M" as if company gets all of it.
Correct behavior: Company only receives primary proceeds. Secondary goes to selling shareholders.
primary_proceeds = offer_price * (primary_shares + greenshoe_shares)
secondary_proceeds = offer_price * secondary_shares
gross_proceeds = primary_proceeds + secondary_proceeds

// Output should show:
Gross Proceeds: $1524M
  Primary (to company): $1153M  // $53 × 21.75M
  Secondary (to sellers): $371M  // $53 × 7M

BUG 8: CEO DIRECTIVE CONTRADICTION NOT FLAGGED
Current behavior: Recommends $53 without noting this still triggers down-round headlines.
Correct behavior: CEO said "I need $45+ to control the narrative" but the REAL issue is Series E was $59.86. Even at $53, CEO's narrative goal FAILS.
Add to output:
CEO DIRECTIVE ANALYSIS:
  CEO min acceptable: $44.00
  Series E basis: $59.86
  Recommended price: $53.00
  
  WARNING: $53 is still -11.5% vs Series E.
  Down-round headline risk PERSISTS regardless of clearing $44/$45 threshold.
  CEO narrative goal ("must not look like down round") is UNACHIEVABLE at any market-clearing price.
  
  Recommendation: Prepare PR messaging acknowledging "2024 market reset" narrative.

CORRECTED DAY-1 POP CALCULATION AT $53:
FactorCurrentCorrectSector baseline+18%+18%Book adjustment+0%−8% (only 2.75× coverage)Valuation penalty−3%−3%Secondary discount−4%−4%Down-round discountMISSING−6%Dual-class discountMISSING−5%Customer concentrationMISSING−3.5%TOTAL+11%−11.5%
At $53, expected Day-1 return is NEGATIVE, not +11%.

CORRECTED RECOMMENDATION:
FieldWrong (Current)CorrectRecommended price$53$44–$46Amended range$51–$54$42–$48 (keep original)Coverage at rec price6.2×11–18×Day-1 pop+11%+8% to +15%Down-round flagMISSINGYES — flag at any price below $59.86Dual-class discountMISSING−5%Price-sensitive drop-offMISSINGShow who drops at each price

END OF INSTRUCTI